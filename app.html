<!DOCTYPE html>
<html lang="ro">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9902358545401183"
     crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <title>CryptoVision – AI Crypto Insights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="CryptoVision – prețuri crypto live, analiză pseudo-AI și insight-uri automate pentru începători și traderi."
  />

  <!-- Chart.js pentru grafice live -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #050816;
      --bg2: #081026;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --danger: #f97373;
      --danger-soft: rgba(248, 113, 113, 0.15);
      --warning: #eab308;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --border: #1f2937;
      --card: #0f172a;
      --card-soft: rgba(15, 23, 42, 0.9);
      --shadow: 0 22px 60px rgba(0, 0, 0, 0.55);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #111827, #020617);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 24px 12px;
    }

    .shell {
      width: 100%;
      max-width: 1280px;
      margin: 0 auto;
      background: linear-gradient(135deg, #020617, #020617 40%, #020617 60%, #020617);
      border-radius: 32px;
      box-shadow: var(--shadow);
      padding: 24px 24px 28px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      position: relative;
      overflow: hidden;
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.11), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(79, 70, 229, 0.11), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(34, 197, 94, 0.12), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      z-index: -1;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      gap: 16px;
      align-items: center;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .logo-wrap {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-badge {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #4ade80, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #020617;
      font-weight: 800;
      font-size: 18px;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.5),
        0 18px 38px rgba(22, 163, 74, 0.55);
    }

    .title-block h1 {
      font-size: 22px;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(96, 165, 250, 0.7);
      color: #bfdbfe;
      background: linear-gradient(
        135deg,
        rgba(37, 99, 235, 0.45),
        rgba(56, 189, 248, 0.1)
      );
      text-transform: uppercase;
    }

    .title-block p {
      font-size: 13px;
      color: var(--text-soft);
      margin-top: 3px;
    }

    .status-wrap {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 12px;
    }

    .live-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.12);
      color: #bbf7d0;
      border: 1px solid rgba(34, 197, 94, 0.6);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
    }

    .updated-at {
      font-size: 12px;
      color: var(--text-soft);
    }

    .grid-top {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 18px;
      margin-bottom: 16px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .feature-pill {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(16px);
    }

    .feature-pill span.icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .feature-pill.good span.icon {
      background: rgba(34, 197, 94, 0.18);
      color: #bbf7d0;
    }

    .feature-pill.info span.icon {
      background: rgba(59, 130, 246, 0.18);
      color: #bfdbfe;
    }

    .feature-pill.ad span.icon {
      background: rgba(234, 179, 8, 0.18);
      color: #fef9c3;
    }

    .feature-pill span.label {
      white-space: nowrap;
    }

    .mini-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }

    .top-info-card {
      padding: 10px 14px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(16px);
      font-size: 12px;
    }

    .top-info-card strong {
      color: #e5e7eb;
    }

    .main-grid {
      display: grid;
      grid-template-columns: minmax(0, 3.3fr) minmax(0, 2.7fr);
      gap: 18px;
    }

    .card {
      background: var(--card-soft);
      border-radius: 22px;
      padding: 14px 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(18px);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.22), transparent 55%);
      opacity: 0;
      transition: opacity 0.35s ease-out;
      pointer-events: none;
      z-index: -1;
    }

    .card:hover::before {
      opacity: 0.25;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: #e5e7eb;
    }

    .badge.green {
      border-color: rgba(34, 197, 94, 0.7);
      background: rgba(22, 163, 74, 0.12);
      color: #bbf7d0;
    }

    .badge.blue {
      border-color: rgba(59, 130, 246, 0.7);
      background: rgba(37, 99, 235, 0.18);
      color: #bfdbfe;
    }

    .badge.orange {
      border-color: rgba(234, 179, 8, 0.7);
      background: rgba(234, 179, 8, 0.16);
      color: #fef3c7;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
      align-items: center;
      font-size: 12px;
    }

    .search-box {
      flex: 1;
    }

    .search-input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      font-size: 12px;
      outline: none;
    }

    .search-input::placeholder {
      color: #6b7280;
    }

    .select-small,
    .btn-small {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      font-size: 11px;
      padding: 6px 9px;
      outline: none;
      cursor: pointer;
    }

    .btn-small.primary {
      background: linear-gradient(to right, #2563eb, #22c55e);
      border-color: transparent;
      color: #ecfeff;
      font-weight: 500;
    }

    .btn-small.primary:hover {
      filter: brightness(1.05);
    }

    .table-wrap {
      max-height: 420px;
      overflow: auto;
      border-radius: 16px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.96), #020617);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: rgba(15, 23, 42, 0.95);
      position: sticky;
      top: 0;
      z-index: 2;
    }

    th, td {
      padding: 7px 10px;
      text-align: right;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      white-space: nowrap;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    th:nth-child(2),
    td:nth-child(2) {
      text-align: left;
    }

    th {
      font-size: 11px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    tbody tr {
      cursor: pointer;
      transition: background 0.15s ease-out;
    }

    tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.85);
    }

    tbody tr:hover {
      background: rgba(37, 99, 235, 0.18);
    }

    .rank {
      color: #6b7280;
      font-size: 11px;
    }

    .coin-name {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .coin-symbol {
      font-size: 10px;
      text-transform: uppercase;
      color: #9ca3af;
      padding: 1px 5px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .chg-pos {
      color: #22c55e;
    }

    .chg-neg {
      color: #f97373;
    }

    .ai-text {
      font-size: 12px;
      line-height: 1.55;
      color: #e5e7eb;
    }

    .ai-text strong {
      color: #bfdbfe;
    }

    .ai-list {
      margin-top: 8px;
      list-style: none;
      font-size: 12px;
      color: #cbd5f5;
    }

    .ai-list li {
      margin-bottom: 4px;
      position: relative;
      padding-left: 14px;
    }

    .ai-list li::before {
      content: "•";
      position: absolute;
      left: 2px;
      color: #60a5fa;
    }

    .small-label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .pair-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      gap: 4px;
      flex-wrap: wrap;
    }

    .pair-name {
      font-size: 14px;
      font-weight: 600;
    }

    .pair-symbol {
      font-size: 11px;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .big-price {
      font-size: 20px;
      font-weight: 600;
    }

    .muted {
      color: #9ca3af;
      font-size: 11px;
    }

    .pill-row-small {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 6px 0 10px;
      font-size: 11px;
    }

    .pill-info {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.9);
    }

    .pill-info.green {
      border-color: rgba(34, 197, 94, 0.7);
      background: var(--accent-soft);
      color: #bbf7d0;
    }

    .pill-info.red {
      border-color: rgba(248, 113, 113, 0.75);
      background: var(--danger-soft);
      color: #fecaca;
    }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      font-size: 11px;
      margin-bottom: 10px;
    }

    .metric-item {
      padding: 6px 8px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(30, 64, 175, 0.8);
    }

    .metric-label {
      color: #9ca3af;
      margin-bottom: 2px;
    }

    .metric-value {
      font-weight: 600;
    }

    .metric-note {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .ai-comment {
      margin-top: 2px;
      padding: 7px 9px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      font-size: 12px;
      line-height: 1.5;
      color: #e5e7eb;
    }

    .scenario-block {
      margin-top: 8px;
      font-size: 11px;
    }

    .scenario-block strong {
      color: #bfdbfe;
    }

    .scenario-list {
      list-style: none;
      margin-top: 4px;
    }

    .scenario-list li {
      margin-bottom: 2px;
    }

    .chart-wrap {
      margin-top: 10px;
      background: radial-gradient(circle at top, rgba(30, 64, 175, 0.4), #020617);
      border-radius: 14px;
      padding: 8px 8px 4px;
      border: 1px solid rgba(30, 64, 175, 0.8);
    }

    .chart-wrap canvas {
      width: 100%;
      height: 210px;
      max-height: 210px;
    }

    .ad-card {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px dashed rgba(234, 179, 8, 0.7);
      background: rgba(24, 16, 3, 0.8);
      font-size: 11px;
      color: #fef9c3;
    }

    .ad-card strong {
      color: #facc15;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 10px;
      color: #6b7280;
      text-align: right;
    }

    @media (max-width: 900px) {
      body {
        padding: 12px 6px;
      }
      .shell {
        border-radius: 20px;
        padding: 14px;
      }
      .grid-top,
      .main-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .status-wrap {
        align-items: flex-start;
      }
      .table-wrap {
        max-height: 360px;
      }
    }
  </style>
</head>

<body>
  <div class="shell">
    <!-- HEADER -->
    <header class="top-bar">
      <div class="logo-wrap">
        <div class="logo-badge">CV</div>
        <div class="title-block">
          <h1>
            CryptoVision
            <span class="title-pill">AI Crypto Insights</span>
          </h1>
          <p>Prețuri crypto live + insight-uri pseudo-AI pentru începători și traderi.</p>
        </div>
      </div>
      <div class="status-wrap">
        <div class="live-badge">
          <span class="dot"></span>
          <span>Live market feed (real-time-ish)</span>
        </div>
        <div class="updated-at" id="updatedAtText">Actualizat: —</div>
      </div>
    </header>

    <!-- FEATURE ROW -->
    <section class="grid-top">
      <div>
        <div class="pill-row">
          <div class="feature-pill good">
            <span class="icon">✓</span>
            <span class="label">Prețuri crypto live (API CoinGecko)</span>
          </div>
          <div class="feature-pill good">
            <span class="icon">✓</span>
            <span class="label">Analiză pseudo-AI multi-TF</span>
          </div>
          <div class="feature-pill info">
            <span class="icon">AI</span>
            <span class="label">Analiză individuală pentru fiecare monedă</span>
          </div>
          <div class="feature-pill info">
            <span class="icon">UX</span>
            <span class="label">Design modern Blue + Dark Mode</span>
          </div>
          <div class="feature-pill ad">
            <span class="icon">Ad</span>
            <span class="label">Zonă dedicată AdSense / afiliere</span>
          </div>
          <div class="feature-pill info">
            <span class="icon">∞</span>
            <span class="label">Structură pregătită pentru upgrade (AI real)</span>
          </div>
        </div>
        <p class="mini-note">
          Totul rulează în browser (GitHub Pages) – fără backend. Mai târziu putem muta
          logica de AI real într-un API separat.
        </p>
      </div>

      <div class="top-info-card">
        <div class="card-header" style="margin-bottom: 6px;">
          <div>
            <div class="card-title">CryptoVision – modul „Auto-Analysis”</div>
            <div class="card-subtitle">
              Date live + reguli inteligente pentru un sentiment rapid asupra pieței.
            </div>
          </div>
          <span class="badge blue">Beta</span>
        </div>
        <p style="margin-bottom: 4px;">
          <strong>Cum funcționează:</strong> CryptoVision ia primele 50 de monede după
          capitalizare, calculează schimbarea medie, cea mai mare creștere/scădere și
          generează un rezumat automat al sentimentului.
        </p>
        <p class="mini-note">
          Acest sistem este pseudo-AI (bazat pe reguli). Oricând putem înlocui engine-ul
          intern cu un model AI real (LSTM / Transformer) fără să schimbăm UI-ul.
        </p>
      </div>
    </section>

    <!-- MAIN GRID -->
    <section class="main-grid">
      <!-- LEFT: TABLE -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Monede urmărite</div>
            <div class="card-subtitle">Top 50 monede după capitalizare – date din CoinGecko.</div>
          </div>
          <span class="badge">USD</span>
        </div>

        <div class="toolbar">
          <div class="search-box">
            <input
              id="searchInput"
              class="search-input"
              type="text"
              placeholder="Caută o monedă (ex: bitcoin, eth, bnb)..."
            />
          </div>
          <select id="sortSelect" class="select-small">
            <option value="rank">Sortare: Market Cap</option>
            <option value="change24">Sortare: Top mișcări 24h</option>
            <option value="change1h">Sortare: Top mișcări 1h</option>
            <option value="change7d">Sortare: Top mișcări 7d</option>
          </select>
          <button id="refreshBtn" class="btn-small primary">Reîmprospătează</button>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Monedă</th>
                <th>Preț</th>
                <th>1h</th>
                <th>24h</th>
                <th>7d</th>
                <th>Market Cap</th>
              </tr>
            </thead>
            <tbody id="coinsBody">
              <!-- rânduri generate dinamic -->
            </tbody>
          </table>
        </div>
      </article>

      <!-- RIGHT: AI PANEL -->
      <article>
        <div class="card" style="margin-bottom: 12px;">
          <div class="card-header">
            <div>
              <div class="card-title">CryptoVision AI – Insight-ul zilei</div>
              <div class="card-subtitle">
                Rezumat automat bazat pe performanța primelor 50 de monede.
              </div>
            </div>
            <span class="badge green">Motor pseudo-AI activ</span>
          </div>
          <div class="ai-text" id="dailyInsight">
            Se încarcă analiza pe baza datelor live...
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Analiza monedei selectate</div>
              <div class="card-subtitle">
                Click pe o monedă în listă pentru detalii + grafic live.
              </div>
            </div>
            <span class="badge orange">Focus asset</span>
          </div>

          <div class="small-label">Monedă selectată</div>
          <div class="pair-header">
            <div>
              <div class="pair-name" id="selectedName">Nicio monedă selectată</div>
              <div class="pair-symbol" id="selectedSymbol">Alege din listă pentru start</div>
            </div>
            <div class="big-price" id="selectedPrice">—</div>
          </div>

          <div class="pill-row-small" id="selectedPills">
            <span class="pill-info">Așteaptă selecția unei monede...</span>
          </div>

          <div class="metric-grid">
            <div class="metric-item">
              <div class="metric-label">Market Cap</div>
              <div class="metric-value" id="metricMarketCap">—</div>
              <div class="metric-note">Dimensiunea proiectului vs. restul pieței.</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Bias direcțional</div>
              <div class="metric-value" id="metricBias">—</div>
              <div class="metric-note">Pseudo-AI pe baza schimbării 24h + 7d.</div>
            </div>
          </div>

          <div class="ai-comment" id="coinComment">
            Selectează o monedă din listă pentru a genera comentariul pseudo-AI &
            zonele de suport/rezistență.
          </div>

          <div class="scenario-block">
            <strong>Scenarii tehnice (auto-generate):</strong>
            <ul class="scenario-list" id="scenarioList">
              <li>—</li>
            </ul>
          </div>

          <div class="chart-wrap">
            <div class="small-label" style="margin-bottom: 4px;">
              Grafic live – ultimele 7 zile (close, USD)
            </div>
            <canvas id="priceChart"></canvas>
          </div>

          <div class="ad-card">
            <strong>ZONA RECLAMĂ / AFILIERE</strong><br />
            Aici poți integra codul tău Google AdSense sau bannere de afiliere crypto /
            link către canalul tău. După ce contul AdSense este aprobat, reclamele
            vor apărea automat.
          </div>
        </div>

        <div class="footer-note">
          CryptoVision – versiune demo. Datele sunt preluate din API public CoinGecko și
          pot avea ușoare întârzieri. Nu este sfat financiar.
        </div>
      </article>
    </section>
  </div>

  <script>
    const API_BASE = "https://api.coingecko.com/api/v3";
    let coinsRaw = [];
    let filteredCoins = [];
    let currentSort = "rank";
    let priceChart = null;
    const chartCache = new Map(); // id -> data chart

    const coinsBody = document.getElementById("coinsBody");
    const searchInput = document.getElementById("searchInput");
    const sortSelect = document.getElementById("sortSelect");
    const refreshBtn = document.getElementById("refreshBtn");
    const updatedAtText = document.getElementById("updatedAtText");
    const dailyInsightEl = document.getElementById("dailyInsight");

    const selectedNameEl = document.getElementById("selectedName");
    const selectedSymbolEl = document.getElementById("selectedSymbol");
    const selectedPriceEl = document.getElementById("selectedPrice");
    const selectedPillsEl = document.getElementById("selectedPills");
    const metricMarketCapEl = document.getElementById("metricMarketCap");
    const metricBiasEl = document.getElementById("metricBias");
    const coinCommentEl = document.getElementById("coinComment");
    const scenarioListEl = document.getElementById("scenarioList");

    async function fetchCoins() {
      const url = `${API_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=false&price_change_percentage=1h,24h,7d`;

      try {
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("Nu am putut prelua datele de la API.");
        const data = await res.json();
        coinsRaw = data;
        filteredCoins = [...coinsRaw];
        applySort();
        renderTable();
        makeDailyInsight();
        updateTimestamp();
      } catch (err) {
        console.error(err);
        dailyInsightEl.textContent =
          "Eroare la încărcarea datelor. Verifică conexiunea sau încearcă din nou în câteva minute (posibil rate-limit CoinGecko).";
      }
    }

    function updateTimestamp() {
      const now = new Date();
      const formatted = now.toLocaleString("ro-RO", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
      updatedAtText.textContent = "Actualizat: " + formatted;
    }

    function formatPrice(value) {
      if (value == null) return "—";
      if (value >= 1000) {
        return "$" + value.toLocaleString("en-US", { maximumFractionDigits: 0 });
      }
      if (value >= 1) {
        return "$" + value.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }
      if (value >= 0.01) {
        return "$" + value.toLocaleString("en-US", { minimumFractionDigits: 4, maximumFractionDigits: 4 });
      }
      return "$" + value.toLocaleString("en-US", { minimumFractionDigits: 6, maximumFractionDigits: 8 });
    }

    function formatPercent(value) {
      if (value == null || isNaN(value)) return "—";
      const sign = value > 0 ? "+" : "";
      return sign + value.toFixed(2) + "%";
    }

    function formatNumberAbbr(value) {
      if (value == null) return "—";
      if (value >= 1_000_000_000_000) {
        return (value / 1_000_000_000_000).toFixed(2) + " T";
      }
      if (value >= 1_000_000_000) {
        return (value / 1_000_000_000).toFixed(2) + " B";
      }
      if (value >= 1_000_000) {
        return (value / 1_000_000).toFixed(2) + " M";
      }
      if (value >= 1_000) {
        return (value / 1_000).toFixed(2) + " K";
      }
      return value.toFixed(0);
    }

    function applySort() {
      const key = currentSort;
      filteredCoins.sort((a, b) => {
        if (key === "rank") {
          return a.market_cap_rank - b.market_cap_rank;
        } else if (key === "change24") {
          return Math.abs(b.price_change_percentage_24h || 0) -
            Math.abs(a.price_change_percentage_24h || 0);
        } else if (key === "change1h") {
          return Math.abs(b.price_change_percentage_1h_in_currency || 0) -
            Math.abs(a.price_change_percentage_1h_in_currency || 0);
        } else if (key === "change7d") {
          return Math.abs(b.price_change_percentage_7d_in_currency || 0) -
            Math.abs(a.price_change_percentage_7d_in_currency || 0);
        }
        return 0;
      });
    }

    function renderTable() {
      coinsBody.innerHTML = "";
      filteredCoins.forEach((coin, idx) => {
        const tr = document.createElement("tr");
        tr.dataset.id = coin.id;

        const rankTd = document.createElement("td");
        rankTd.innerHTML = `<span class="rank">${coin.market_cap_rank ?? "?"}</span>`;
        tr.appendChild(rankTd);

        const nameTd = document.createElement("td");
        nameTd.innerHTML = `
          <div class="coin-name">
            <span>${coin.name}</span>
            <span class="coin-symbol">${coin.symbol}</span>
          </div>
        `;
        tr.appendChild(nameTd);

        const priceTd = document.createElement("td");
        priceTd.textContent = formatPrice(coin.current_price);
        tr.appendChild(priceTd);

        const chg1hTd = document.createElement("td");
        const chg1h = coin.price_change_percentage_1h_in_currency;
        chg1hTd.textContent = formatPercent(chg1h);
        chg1hTd.className = chg1h > 0 ? "chg-pos" : chg1h < 0 ? "chg-neg" : "";
        tr.appendChild(chg1hTd);

        const chg24Td = document.createElement("td");
        const chg24 = coin.price_change_percentage_24h;
        chg24Td.textContent = formatPercent(chg24);
        chg24Td.className = chg24 > 0 ? "chg-pos" : chg24 < 0 ? "chg-neg" : "";
        tr.appendChild(chg24Td);

        const chg7dTd = document.createElement("td");
        const chg7d = coin.price_change_percentage_7d_in_currency;
        chg7dTd.textContent = formatPercent(chg7d);
        chg7dTd.className = chg7d > 0 ? "chg-pos" : chg7d < 0 ? "chg-neg" : "";
        tr.appendChild(chg7dTd);

        const mcTd = document.createElement("td");
        mcTd.textContent = "$" + formatNumberAbbr(coin.market_cap ?? 0);
        tr.appendChild(mcTd);

        tr.addEventListener("click", () => handleCoinClick(coin.id));

        coinsBody.appendChild(tr);
      });
    }

    function makeDailyInsight() {
      if (!coinsRaw || coinsRaw.length === 0) {
        dailyInsightEl.textContent =
          "Nu există suficiente date pentru analiză. Încearcă să reîncarci pagina.";
        return;
      }

      let sum24 = 0;
      let count24 = 0;
      let topGainer = null;
      let topLoser = null;
      let highVolMoves = 0;

      coinsRaw.forEach((c) => {
        const chg = c.price_change_percentage_24h;
        if (chg != null && !isNaN(chg)) {
          sum24 += chg;
          count24++;
          if (!topGainer || chg > topGainer.price_change_percentage_24h) {
            topGainer = c;
          }
          if (!topLoser || chg < topLoser.price_change_percentage_24h) {
            topLoser = c;
          }
          if (Math.abs(chg) >= 5) highVolMoves++;
        }
      });

      const avg24 = count24 ? sum24 / count24 : 0;
      let mood;
      if (avg24 > 1.5) mood = "bullish (pozitiv)";
      else if (avg24 < -1.5) mood = "bearish (negativ)";
      else mood = "echilibrat / lateral";

      const volatility =
        highVolMoves >= 10
          ? "ridicată (multe mișcări peste ±5% în 24h)"
          : highVolMoves >= 4
          ? "medie (câteva monede cu spike-uri puternice)"
          : "scăzută (majoritatea monedelor mișcări moderate)";

      const text = `
        <p>
          Pe baza primelor <strong>${count24}</strong> monede după capitalizare,
          sentimentul general al pieței astăzi pare
          <strong>${mood}</strong>, cu o schimbare medie de
          <strong>${avg24.toFixed(2)}%</strong> în ultimele 24 de ore.
        </p>
        <ul class="ai-list">
          <li>
            <strong>Cea mai performantă monedă</strong> este
            <strong>${topGainer?.name ?? "N/A"}</strong> (${formatPercent(
        topGainer?.price_change_percentage_24h
      )} / 24h).
          </li>
          <li>
            <strong>Cea mai slabă monedă</strong> este
            <strong>${topLoser?.name ?? "N/A"}</strong> (${formatPercent(
        topLoser?.price_change_percentage_24h
      )} / 24h).
          </li>
          <li>
            <strong>Volatilitatea globală</strong> este evaluată ca
            <strong>${volatility}</strong>.
          </li>
          <li>
            Pentru intrări noi, zona de risc este mai mare pe monedele cu mișcări
            extreme &gt; ±8% – acestea pot oferi oportunități, dar și corecții
            agresive.
          </li>
        </ul>
      `;
      dailyInsightEl.innerHTML = text;
    }

    function filterCoins() {
      const q = searchInput.value.toLowerCase().trim();
      if (!q) {
        filteredCoins = [...coinsRaw];
      } else {
        filteredCoins = coinsRaw.filter(
          (c) =>
            c.name.toLowerCase().includes(q) ||
            c.symbol.toLowerCase().includes(q)
        );
      }
      applySort();
      renderTable();
    }

    function handleSortChange() {
      currentSort = sortSelect.value;
      applySort();
      renderTable();
    }

    async function handleCoinClick(id) {
      const coin = coinsRaw.find((c) => c.id === id);
      if (!coin) return;

      selectedNameEl.textContent = coin.name;
      selectedSymbolEl.textContent = coin.symbol.toUpperCase() + " / USD";
      selectedPriceEl.textContent = formatPrice(coin.current_price);
      metricMarketCapEl.textContent = "$" + formatNumberAbbr(coin.market_cap ?? 0);

      selectedPillsEl.innerHTML = "";

      const pill24 = document.createElement("span");
      pill24.className =
        "pill-info " +
        (coin.price_change_percentage_24h > 0
          ? "green"
          : coin.price_change_percentage_24h < 0
          ? "red"
          : "");
      pill24.textContent = "24h: " + formatPercent(coin.price_change_percentage_24h);
      selectedPillsEl.appendChild(pill24);

      const pill1h = document.createElement("span");
      pill1h.className =
        "pill-info " +
        (coin.price_change_percentage_1h_in_currency > 0
          ? "green"
          : coin.price_change_percentage_1h_in_currency < 0
          ? "red"
          : "");
      pill1h.textContent = "1h: " + formatPercent(coin.price_change_percentage_1h_in_currency);
      selectedPillsEl.appendChild(pill1h);

      const pill7d = document.createElement("span");
      pill7d.className =
        "pill-info " +
        (coin.price_change_percentage_7d_in_currency > 0
          ? "green"
          : coin.price_change_percentage_7d_in_currency < 0
          ? "red"
          : "");
      pill7d.textContent = "7d: " + formatPercent(coin.price_change_percentage_7d_in_currency);
      selectedPillsEl.appendChild(pill7d);

      const biasInfo = computeBias(coin);
      metricBiasEl.textContent = biasInfo.label;
      coinCommentEl.textContent = biasInfo.comment;
      renderScenarios(coin, biasInfo);

      await loadChartForCoin(coin);
    }

    function computeBias(coin) {
      const ch24 = coin.price_change_percentage_24h ?? 0;
      const ch7 = coin.price_change_percentage_7d_in_currency ?? 0;
      const price = coin.current_price ?? 0;

      const support = price * 0.97;
      const resistance = price * 1.03;

      let bias = "Neutru";
      let prob = 50;
      let comment = "";

      if (ch24 > 4 && ch7 > 10) {
        bias = "Puternic bullish";
        prob = 70;
        comment =
          `${coin.name} este într-un impuls clar ascendent – creștere solidă în ultimele 24h și trend pozitiv pe 7 zile. ` +
          `Atât timp cât prețul rămâne peste zona de suport ~${formatPrice(
            support
          )}, scenariile de corecție sunt considerate healthy pullback.`;
      } else if (ch24 > 1 && ch7 >= 0) {
        bias = "Bullish moderat";
        prob = 60;
        comment =
          `${coin.name} arată un momentum pozitiv, dar fără exagerări extreme. ` +
          `Zona de suport estimată este ~${formatPrice(
            support
          )}, iar prima rezistență importantă se află în jurul ${formatPrice(
            resistance
          )}.`;
      } else if (ch24 < -4 && ch7 < -8) {
        bias = "Puternic bearish";
        prob = 72;
        comment =
          `${coin.name} se află sub presiune puternică de vânzare atât pe termen scurt, cât și pe 7 zile. ` +
          `Sub suportul din jur de ${formatPrice(
            support
          )} pot apărea accelerări suplimentare ale trendului descendent.`;
      } else if (ch24 < -1 && ch7 <= 0) {
        bias = "Bearish moderat";
        prob = 60;
        comment =
          `${coin.name} arată slăbiciune pe termen scurt. ` +
          `Dacă prețul nu recuperează rapid spre ${formatPrice(
            resistance
          )}, scenariile de continuare a trendului descendent rămân deschise.`;
      } else {
        bias = "Neutru / consolidare";
        prob = 50;
        comment =
          `${coin.name} se află într-o zonă de echilibru, fără un avantaj clar pentru tauri sau urși. ` +
          `Reacția la suport (${formatPrice(
            support
          )}) și la rezistență (${formatPrice(
            resistance
          )}) va oferi direcția următoare.`;
      }

      return {
        label: `${bias} (${prob}% înclinare)`,
        comment,
        support,
        resistance,
        bias,
        prob
      };
    }

    function renderScenarios(coin, biasInfo) {
      const price = coin.current_price ?? 0;
      const sup = biasInfo.support;
      const res = biasInfo.resistance;

      const longTrigger = res * 1.005;
      const shortTrigger = sup * 0.995;

      scenarioListEl.innerHTML = "";
      const liLong = document.createElement("li");
      liLong.textContent =
        `Long activ doar peste ${formatPrice(longTrigger)} (confirmare breakout peste rezistență).`;
      const liShort = document.createElement("li");
      liShort.textContent =
        `Short activ doar sub ${formatPrice(shortTrigger)} (pierdere clară a suportului).`;
      const liRisk = document.createElement("li");
      liRisk.textContent =
        `Pentru intrări noi, zona "no trade" este aproximativ între ${formatPrice(
          sup
        )} și ${formatPrice(res)} – consolidare / indecizie.`;

      scenarioListEl.appendChild(liLong);
      scenarioListEl.appendChild(liShort);
      scenarioListEl.appendChild(liRisk);
    }

    async function loadChartForCoin(coin) {
      const id = coin.id;
      let chartData = chartCache.get(id);

      if (!chartData) {
        try {
          const url = `${API_BASE}/coins/${id}/market_chart?vs_currency=usd&days=7&interval=hourly`;
          const res = await fetch(url);
          if (!res.ok) throw new Error("Nu am putut încărca istoricul pentru grafic.");
          const data = await res.json();
          const prices = data.prices || [];

          const labels = [];
          const values = [];

          const step = Math.max(1, Math.floor(prices.length / 80)); // max ~80 puncte
          for (let i = 0; i < prices.length; i += step) {
            const [ts, price] = prices[i];
            const d = new Date(ts);
            labels.push(
              d.toLocaleDateString("ro-RO", {
                day: "2-digit",
                month: "2-digit"
              }) +
              " " +
              d.toLocaleTimeString("ro-RO", {
                hour: "2-digit",
                minute: "2-digit"
              })
            );
            values.push(price);
          }

          chartData = { labels, values };
          chartCache.set(id, chartData);
        } catch (err) {
          console.error(err);
          return;
        }
      }

      const ctx = document.getElementById("priceChart").getContext("2d");
      if (priceChart) {
        priceChart.destroy();
      }

      priceChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: chartData.labels,
          datasets: [
            {
              label: `${coin.name} – preț (USD)`,
              data: chartData.values,
              borderWidth: 2,
              pointRadius: 0,
              tension: 0.25
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: "#e5e7eb",
                font: { size: 10 }
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: "#9ca3af",
                maxRotation: 0,
                autoSkip: true,
                autoSkipPadding: 16
              },
              grid: {
                display: false
              }
            },
            y: {
              ticks: {
                color: "#9ca3af",
                callback: (value) => "$" + value.toFixed(0)
              },
              grid: {
                color: "rgba(55, 65, 81, 0.6)"
              }
            }
          }
        }
      });
    }

    // EVENT LISTENERS
    searchInput.addEventListener("input", filterCoins);ap
    sortSelect.addEventListener("change", handleSortChange);
    refreshBtn.addEventListener("click", fetchCoins);

    // INIT
    fetchCoins();
  </script><script>
 // ------------------------------
// BACKEND CONFIG (placeholder)
// ------------------------------
const BACKEND_BASE_URL = "https://YOUR-BACKEND-URL-HERE";


// ------------------------------
// AI BACKEND TEST (FINAL VERSION)
// ------------------------------
async function handleAiBackendTest() {

    const input = document.getElementById("ai-coin-id-input");
    const resultBox = document.getElementById("ai-backend-result");

    const coinId = (input.value || "bitcoin").trim();
    if (!coinId) {
        resultBox.textContent = "Please enter a coin ID.";
        return;
    }

    const url = `${BACKEND_BASE_URL}/demo/prediction?coin_id=${encodeURIComponent(coinId)}&days=90`;
    resultBox.textContent = "Loading from backend...\n" + url;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            resultBox.textContent = "Backend error: " + response.status;
            return;
        }

        const data = await response.json();

        // === UPDATE AI SUMMARY CARD ===
        document.getElementById("ai-summary-coin").textContent = data.coin_id;
        document.getElementById("ai-summary-last").textContent = data.last_price.toFixed(2);
        document.getElementById("ai-summary-predicted").textContent = data.predicted_price.toFixed(2);
        document.getElementById("ai-summary-rsi").textContent = data.indicators.rsi.toFixed(2);

        // === Show JSON in test panel ===
        resultBox.textContent =
            "=== AI Backend Response ===\n\n" +
            JSON.stringify(data, null, 2);

    } catch (error) {
        resultBox.textContent = "Fetch error: " + error;
    }
}

</script>

</body><!-- ====== AI Backend Test Panel ====== -->
<section id="ai-backend-panel" style="margin-top: 24px; padding: 16px; border-radius: 8px; background: #0d1220; border: 1px solid #1f2937;">
  <h2 style="margin-bottom: 8px;">AI Backend Test</h2>
  <p style="font-size: 14px; opacity: 0.8; margin-bottom: 12px;">
    Enter a CoinGecko coin ID (e.g. <code>bitcoin</code>, <code>ethereum</code>) and press the button to call the backend demo endpoint.
  </p>
  <div style="display:flex; gap:8px; align-items:center; margin-bottom: 12px; flex-wrap:wrap;">
    <label for="ai-coin-id-input" style="font-size:14px;">Coin ID:</label>
    <input
      id="ai-coin-id-input"
      type="text"
      value="bitcoin"
      style="padding:6px 10px; border-radius:6px; border:1px solid #374151; background:#020617; color:#f9fafb; min-width:140px;"
    />
    <button
      type="button"
      onclick="handleAiBackendTest()"
      style="padding:6px 14px; border-radius:999px; border:none; background:#22c55e; color:#020617; font-weight:600; cursor:pointer;"
    >
      Test AI Backend
    </button>
  </div>

  <pre
    id="ai-backend-result"
    style="max-height:260px; overflow:auto; background:#020617; border-radius:6px; padding:10px; font-size:12px; border:1px solid #1f2937; color:#e5e7eb;"
  >No request sent yet.</pre>
</section><!-- ====== AI Summary Card ====== -->
<section id="ai-summary-card" style="margin-top: 16px; padding: 16px; border-radius: 8px; background: #020617; border: 1px solid #1f2937;">
  <h3 style="margin-bottom: 8px;">AI Summary (Demo)</h3>
  <p style="font-size: 13px; opacity: 0.8; margin-bottom: 10px;">
    This box will show a short summary based on the latest AI backend response.
  </p>
  <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; font-size: 13px;">
    <div>
      <div style="opacity:0.7;">Coin</div>
      <strong id="ai-summary-coin">-</strong>
    </div>
    <div>
      <div style="opacity:0.7;">Last price</div>
      <strong id="ai-summary-last">-</strong>
    </div>
    <div>
      <div style="opacity:0.7;">Predicted price</div>
      <strong id="ai-summary-predicted">-</strong>
    </div>
    <div>
      <div style="opacity:0.7;">RSI</div>
      <strong id="ai-summary-rsi">-</strong>
    </div>
  </div>
</section>
<!-- ==== /AI Summary Card ==== -->

<!-- ==== /AI Backend Test Panel ==== -->

</html>
