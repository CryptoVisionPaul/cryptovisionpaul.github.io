<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CryptoVision – AI Crypto Insights</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#020617;
  color:#e5e7eb;
}
.container{
  max-width:900px;
  margin:40px auto;
  padding:20px;
}
h1{margin-bottom:10px}
button{
  padding:8px 14px;
  border-radius:6px;
  border:none;
  background:#22c55e;
  color:#020617;
  font-weight:700;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #1f2937;
}
th{text-align:left;color:#9ca3af}
.up{color:#22c55e}
.down{color:#f87171}
</style>
</head>

<body>
<div class="container">
  <h1>CryptoVision</h1>
  <button id="refreshBtn">Refresh</button>

  <table>
    <thead>
      <tr>
        <th>Coin</th>
        <th>Price (USD)</th>
        <th>Trend</th>
      </tr>
    </thead>
    <tbody id="coinsBody"></tbody>
  </table>
</div>

<script>
// ------------------------------
// BACKEND: FETCH TOP COINS (REAL DATA)
// ------------------------------
async function fetchCoins() {
  const url =
    `${BACKEND_BASE_URL}/coins/markets` +
    `?vs_currency=usd` +
    `&order=market_cap_desc` +
    `&per_page=50` +
    `&page=1` +
    `&sparkline=false` +
    `&price_change_percentage=1h,24h,7d`;

  try {
    dailyInsightEl.textContent = "Loading market analysis...";
    const res = await fetch(url, { cache: "no-store" });

    if (!res.ok) {
      throw new Error("Backend error HTTP " + res.status);
    }

    const data = await res.json();

    // IMPORTANT: backend returns ARRAY
    coinsRaw = Array.isArray(data) ? data : [];
    filteredCoins = [...coinsRaw];

    applySort();
    renderTable();
    makeDailyInsight();
    updateTimestamp();

  } catch (err) {
    console.error(err);
    dailyInsightEl.textContent =
      "❌ Failed to load market data from backend.";
  }
}


/* =========================
   EVENTS
========================= */
document.getElementById("refreshBtn").onclick = fetchCoins;
fetchCoins();
</script>
</body>
</html>
